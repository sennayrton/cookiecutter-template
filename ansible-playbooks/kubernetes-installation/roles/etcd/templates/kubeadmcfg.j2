---
apiVersion: "kubeadm.k8s.io/v1beta3"
kind: InitConfiguration
nodeRegistration:
    name: {{ ansible_hostname }}
localAPIEndpoint:
    advertiseAddress: {{ ansible_host }}
---
apiVersion: "kubeadm.k8s.io/v1beta3"
kind: ClusterConfiguration
etcd:
    local:
        imageRepository: "{{ registry_domain }}:{{ registry_port }}/k8s.gcr.io"
        imageTag: "{{ etcd_image_version }}"
        dataDir: "/usr/local/pr/{{ entorno }}/{{ user_home_dir }}/etcd"
        serverCertSANs:
        - "{{ ansible_host }}"
        peerCertSANs:
        - "{{ ansible_host }}"
        extraArgs:
            initial-cluster: {{ groups['etcd'][0] }}=https://{{ hostvars[groups['etcd'][0]]['ansible_default_ipv4']['address'] }}:2380,{{ groups['etcd'][1] }}=https://{{ hostvars[groups['etcd'][1]]['ansible_default_ipv4']['address'] }}:2380,{{ groups['etcd'][2] }}=https://{{ hostvars[groups['etcd'][2]]['ansible_default_ipv4']['address'] }}:2380
            initial-cluster-state: new
            name: {{ ansible_hostname }}
            listen-peer-urls: https://{{ ansible_host }}:2380
            listen-client-urls: https://{{ ansible_host }}:2379
            advertise-client-urls: https://{{ ansible_host }}:2379
            initial-advertise-peer-urls: https://{{ ansible_host }}:2380

